<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberLearn – บทเรียน</title>
  <style>
    body{font-family:system-ui,-apple-system,"Kanit",sans-serif;margin:0;background:#f6f7fb;color:#0f172a}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e2e8f0;padding:16px 20px}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 20px}
    h1{margin:0;font-size:1.4rem}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-top:16px}
    .card{display:block;background:#fff;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden;text-decoration:none;color:inherit;transition:.2s}
    .card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}
    .thumb{aspect-ratio:16/9;background:#eef2ff;display:grid;place-items:center;font-size:40px}
    .card h3{margin:12px 14px 6px;font-size:1.05rem}
    .card p{margin:0 14px 16px;color:#475569;font-size:.95rem;line-height:1.5}
    footer{margin-top:28px;color:#64748b}
  </style>
</head>
<body>
  <header><div class="wrap"><h1>บทเรียน CyberLearn</h1></div></header>
  <main class="wrap">
    <div id="cards" class="cards" aria-live="polite"></div>
    <footer>ไปหลังบ้าน: <a href="/admin/">/admin</a></footer>
  </main>

  <script>
  async function loadLessons() {
    const wrap = document.getElementById('cards');
    wrap.innerHTML = 'กำลังโหลด…';
    try {
      const res = await fetch('/api/public/lessons');
      const data = await res.json();
      const items = data.items || [];
      if (!items.length) {
        wrap.innerHTML = 'ยังไม่มีบทเรียนที่เผยแพร่';
        return;
      }
      wrap.innerHTML = '';
      for (const it of items) {
        const url = `/lessons/${encodeURIComponent(it.slug)}`;
        const img = it.cover_image || 'https://picsum.photos/seed/placeholder/640/360';
        const card = document.createElement('a');
        card.className = 'card';
        card.href = url;
        card.innerHTML = `
          <div class="thumb"><img src="${img}" alt="" style="width:100%;height:100%;object-fit:cover"></div>
          <h3>${escapeHtml(it.title || '')}</h3>
          <p>${escapeHtml(it.summary || '')}</p>
        `;
        wrap.appendChild(card);
      }
    } catch (e) {
      console.error(e);
      wrap.innerHTML = 'โหลดข้อมูลไม่สำเร็จ';
    }
  }

  // กัน XSS ง่าย ๆ เวลาฝัง text จากฐานข้อมูล
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  document.addEventListener('DOMContentLoaded', loadLessons);
  </script>
</body>
</html>
